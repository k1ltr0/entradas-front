<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>8ª edición de Aguas Abiertas Chile 2025</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header/Banner */
        .banner {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 60px 0;
            text-align: center;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .banner::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="white" opacity="0.1"/><circle cx="75" cy="75" r="1" fill="white" opacity="0.1"/><circle cx="50" cy="10" r="0.5" fill="white" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
            pointer-events: none;
        }

        .banner-content {
            position: relative;
            z-index: 2;
        }

        .banner img {
            max-width: 120px;
            margin-bottom: 20px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
        }

        .banner h1 {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .banner p {
            font-size: 1.2rem;
            opacity: 0.9;
            font-weight: 300;
        }

        /* Main Content */
        .main-content {
            background: white;
            border-radius: 20px 20px 0 0;
            margin-top: -20px;
            position: relative;
            z-index: 3;
            box-shadow: 0 -10px 30px rgba(0,0,0,0.1);
        }

        .content-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 60px;
            padding: 60px 0;
        }

        /* Event Details */
        .event-details {
            padding: 0;
        }

        .event-details h2 {
            font-size: 2.5rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 30px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .event-info {
            background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
            padding: 30px;
            border-radius: 16px;
            border: 1px solid #e2e8f0;
            margin-bottom: 30px;
        }

        .info-item {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .info-item:last-child {
            margin-bottom: 0;
        }

        .info-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            color: white;
            font-weight: 600;
        }

        .info-content h4 {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .info-content p {
            color: #718096;
            font-size: 0.95rem;
        }

        .features-list {
            list-style: none;
            margin-top: 20px;
        }

        .features-list li {
            padding: 12px 0;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            align-items: center;
        }

        .features-list li:last-child {
            border-bottom: none;
        }

        .features-list li::before {
            content: '✓';
            color: #48bb78;
            font-weight: bold;
            margin-right: 12px;
            font-size: 1.2rem;
        }

        /* Gallery Section */
        .gallery-section h3 {
            font-size: 2rem;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 30px;
            text-align: center;
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
        }

        .gallery-item {
            position: relative;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            transition: all 0.3s ease;
            cursor: pointer;
            background: white;
        }

        .gallery-item:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }

        .gallery-item img,
        .gallery-item video {
            width: 100%;
            height: 140px;
            object-fit: cover;
            display: block;
        }

        .gallery-item video {
            background-color: #000;
        }

        .video-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 10px 16px;
            border-radius: 25px;
            font-size: 12px;
            font-weight: 600;
            pointer-events: none;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        /* Ticket Form */
        .ticket-form {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 50px 40px;
            border-radius: 20px;
            color: white;
            margin: 40px 0;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }

        .ticket-form h2 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 30px;
            text-align: center;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 0.95rem;
            opacity: 0.9;
        }

        input, select {
            width: 100%;
            padding: 15px;
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 12px;
            background: rgba(255,255,255,0.1);
            color: white;
            font-size: 16px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        input::placeholder {
            color: rgba(255,255,255,0.7);
        }

        input:focus, select:focus {
            outline: none;
            border-color: rgba(255,255,255,0.5);
            background: rgba(255,255,255,0.15);
            transform: translateY(-2px);
        }

        select {
            appearance: none;
            background-image: url('data:image/svg+xml;utf8,<svg fill="%23ffffff" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M7.293 7.293a1 1 0 011.414 0L10 8.586l1.293-1.293a1 1 0 111.414 1.414l-2 2a1 1 0 01-1.414 0l-2-2a1 1 0 010-1.414z"/></svg>');
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 20px 20px;
        }

        button {
            background: linear-gradient(135deg, #48bb78, #38a169);
            color: white;
            padding: 18px 40px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 8px 20px rgba(72, 187, 120, 0.3);
            width: 100%;
            margin-top: 20px;
        }

        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(72, 187, 120, 0.4);
        }

        button:disabled {
            transform: none;
            box-shadow: 0 4px 12px rgba(72, 187, 120, 0.2);
            cursor: not-allowed;
        }

        button:disabled:hover {
            transform: none;
            box-shadow: 0 4px 12px rgba(72, 187, 120, 0.2);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            backdrop-filter: blur(10px);
        }

        .modal-content {
            margin: auto;
            display: block;
            max-width: 90%;
            max-height: 90%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }

        .close {
            position: absolute;
            top: 20px;
            right: 30px;
            color: #f1f1f1;
            font-size: 40px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 1001;
        }

        .close:hover {
            color: #fff;
            transform: scale(1.1);
        }

        .nav-button {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 20px 25px;
            font-size: 24px;
            cursor: pointer;
            border-radius: 50%;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .nav-button:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-50%) scale(1.1);
        }

        .nav-button:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .prev-button {
            left: 30px;
        }

        .next-button {
            right: 30px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .banner h1 {
                font-size: 2rem;
            }

            .content-container {
                grid-template-columns: 1fr;
                gap: 40px;
                padding: 40px 0;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .gallery-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 12px;
            }

            .ticket-form {
                padding: 30px 20px;
                margin: 20px 0;
            }

            .nav-button {
                padding: 15px 20px;
                font-size: 20px;
            }

            .prev-button {
                left: 15px;
            }

            .next-button {
                right: 15px;
            }
        }

        @media (max-width: 480px) {
            .banner {
                padding: 40px 0;
            }

            .banner h1 {
                font-size: 1.8rem;
            }

            .event-details h2 {
                font-size: 2rem;
            }

            .gallery-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .prices-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 24px;
            margin-top: 20px;
        }
        .price-card {
            background: linear-gradient(135deg, #f7fafc 0%, #e9d8fd 100%);
            border-radius: 16px;
            box-shadow: 0 4px 16px rgba(118, 75, 162, 0.08);
            padding: 32px 20px;
            text-align: center;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .price-card:hover {
            transform: translateY(-6px) scale(1.03);
            box-shadow: 0 8px 32px rgba(118, 75, 162, 0.15);
        }
        .price-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #5a189a;
            margin-bottom: 10px;
        }
        .price-value {
            font-size: 2rem;
            font-weight: 700;
            color: #764ba2;
        }
        .price-card.agotada {
            opacity: 0.5;
            position: relative;
        }
        .agotada-label {
            position: absolute;
            top: 18px;
            right: 18px;
            background: #e53e3e;
            color: white;
            font-size: 0.95rem;
            font-weight: 700;
            padding: 6px 16px;
            border-radius: 20px;
            box-shadow: 0 2px 8px rgba(229,62,62,0.15);
            letter-spacing: 1px;
        }

        select, select option {
            color: #2d3748 !important;
            background: white !important;
        }

        input {
            background: white !important;
            color: #2d3748 !important;
        }
        input::placeholder {
            color: #718096 !important;
        }
    </style>
</head>
<body>
    <div class="banner">
        <div class="container">
            <div class="banner-content">
                <img src="logo.jpg" alt="Logo del evento">
                <h1>8ª edición de Aguas Abiertas Chile 2025</h1>
                <p>¡Prepárate para vivir la emoción de las Aguas Abiertas en Chile!</p>
            </div>
        </div>
    </div>

    <div class="main-content">
        <div class="container">
            <div class="content-container">
                <div class="event-details">
                    <h2>Detalles del Evento</h2>

                    <div class="event-info">
                        <div class="info-item">
                            <div class="info-icon">📅</div>
                            <div class="info-content">
                                <h4>¿Cuándo?</h4>
                                <p>25 de octubre de 2025</p>
                            </div>
                        </div>
                        <div class="info-item">
                            <div class="info-icon">⏰</div>
                            <div class="info-content">
                                <h4>¿Desde qué hora?</h4>
                                <p>07:00 AM</p>
                            </div>
                        </div>
                        <div class="info-item">
                            <div class="info-icon">📍</div>
                            <div class="info-content">
                                <h4>¿Dónde?</h4>
                                <p>Laguna Miranda’s Ski-School, San Bernardo</p>
                            </div>
                        </div>
                        <div class="info-item">
                            <div class="info-icon">💰</div>
                            <div class="info-content">
                                <h4>Ubicación</h4>
                                <p>Camino Nos Los Morros #10, San Bernardo.</p>
                            </div>
                        </div>
                    </div>

                    <h3 style="margin-bottom: 20px; color: #2d3748;">¿Qué incluye tu entrada?</h3>
                    <ul class="features-list">
                        <li>Recorrido de la competencia boyado de 1.000 metros</li>
                        <li>Kit de participante</li>
                        <li>Equipo de salvavidas y personal médico capacitado.</li>
                        <li>Hidratación durante el evento</li>
                        <li>Medallas de Oro, Plata y Bronce a los tres primeros lugares de cada categoría y distancia</li>
                        <li>Premio a mejor marca técnica dama y varón 2K</li>
                        <li>Trofeo a los 3 equipos con mejor desempeño general (medallero)</li>
                    </ul>

                    <!-- Sección de precios -->
                    <div class="prices-section" style="margin: 40px 0;">
                        <h3 style="color: #2d3748; text-align: center; margin-bottom: 24px;">Valores de Inscripción</h3>
                        <div class="prices-grid">
                            <div class="price-card">
                                <div class="price-title">Preventa Prueba Individual</div>
                                <div class="price-value">$25.000.-</div>
                            </div>
                            <div class="price-card">
                                <div class="price-title">Preventa Prueba Relevo</div>
                                <div class="price-value">$60.000.-</div>
                            </div>
                            <div class="price-card">
                                <div class="price-title">Venta General Prueba Individual</div>
                                <div class="price-value">$35.000.-</div>
                            </div>
                            <div class="price-card">
                                <div class="price-title">Venta General Prueba Relevo</div>
                                <div class="price-value">$90.000.-</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="gallery-section">
                    <h3>Galería del Evento</h3>
                    <div class="gallery-grid">
                        <div class="gallery-item" onclick="openModal('gallery/WhatsApp Image 2025-05-22 at 08.36.08_2ccf344b.jpg', 'image')">
                            <img src="gallery/WhatsApp Image 2025-05-22 at 08.36.08_2ccf344b.jpg" alt="Imagen del evento">
                        </div>
                        <div class="gallery-item" onclick="openModal('gallery/WhatsApp Image 2025-05-22 at 08.36.08_beee2ebf.jpg', 'image')">
                            <img src="gallery/WhatsApp Image 2025-05-22 at 08.36.08_beee2ebf.jpg" alt="Imagen del evento">
                        </div>
                        <div class="gallery-item" onclick="openModal('gallery/WhatsApp Image 2025-05-22 at 08.36.08_d5d63017.jpg', 'image')">
                            <img src="gallery/WhatsApp Image 2025-05-22 at 08.36.08_d5d63017.jpg" alt="Imagen del evento">
                        </div>
                        <div class="gallery-item" onclick="openModal('gallery/WhatsApp Image 2025-05-22 at 08.36.09_20ca8526.jpg', 'image')">
                            <img src="gallery/WhatsApp Image 2025-05-22 at 08.36.09_20ca8526.jpg" alt="Imagen del evento">
                        </div>
                        <div class="gallery-item" onclick="openModal('gallery/WhatsApp Image 2025-05-22 at 08.36.11_41270771.jpg', 'image')">
                            <img src="gallery/WhatsApp Image 2025-05-22 at 08.36.11_41270771.jpg" alt="Imagen del evento">
                        </div>
                        <div class="gallery-item" onclick="openModal('gallery/WhatsApp Image 2025-05-22 at 08.36.14_8faaf407.jpg', 'image')">
                            <img src="gallery/WhatsApp Image 2025-05-22 at 08.36.14_8faaf407.jpg" alt="Imagen del evento">
                        </div>
                        <div class="gallery-item" onclick="openModal('gallery/WhatsApp Video 2025-05-22 at 08.36.11_b1a08203.mp4', 'video')">
                            <video src="gallery/WhatsApp Video 2025-05-22 at 08.36.11_b1a08203.mp4" muted></video>
                            <div class="video-overlay">▶ VIDEO</div>
                        </div>
                        <div class="gallery-item" onclick="openModal('gallery/WhatsApp Video 2025-05-22 at 08.36.14_c4fba06f.mp4', 'video')">
                            <video src="gallery/WhatsApp Video 2025-05-22 at 08.36.14_c4fba06f.mp4" muted></video>
                            <div class="video-overlay">▶ VIDEO</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="ticket-form">
                <h2>¡Reserva tu lugar ahora!</h2>
                <form id="ticketForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="name">Nombre completo</label>
                            <input type="text" id="name" placeholder="Tu nombre completo" required>
                        </div>
                        <div class="form-group">
                            <label for="email">Correo electrónico</label>
                            <input type="email" id="email" placeholder="tu@email.com" required>
                        </div>
                        <div class="form-group">
                            <label for="phone">Teléfono</label>
                            <input type="tel" id="phone" placeholder="+56 9 8231 8236" required>
                        </div>
                        <div class="form-group">
                            <label for="gender">Género</label>
                            <select id="gender" required>
                                <option value="">Selecciona tu género</option>
                                <option value="femenino">Femenino</option>
                                <option value="masculino">Masculino</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="age">Edad</label>
                            <input type="number" id="age" min="6" max="100" placeholder="Tu edad" required>
                        </div>
                        <div class="form-group">
                            <label for="club">Club</label>
                            <input type="text" id="club" placeholder="Nombre del club o 'Independiente'" required>
                        </div>
                        <div class="form-group">
                            <label for="category">Categoría</label>
                            <input type="text" id="category" readonly placeholder="Se selecciona automáticamente">
                        </div>
                        <div class="form-group">
                            <label for="stage">Etapa</label>
                            <select id="stage" required>
                                <option value="">Selecciona una etapa</option>
                                <option value="preventa">Preventa</option>
                                <option value="general" disabled>Venta General</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="testType">Tipo de Prueba</label>
                            <select id="testType" required>
                                <option value="individual">Individual</option>
                                <option value="relevo">Relevo</option>
                            </select>
                        </div>
                        <div class="form-group full-width">
                            <label for="distance">Distancia</label>
                            <select id="distance" required>
                                <option value="">Selecciona una distancia</option>
                            </select>
                        </div>
                    </div>
                    <button type="submit" id="buyButton">🎯 Comprar Entrada</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal para vista ampliada -->
    <div id="imageModal" class="modal">
        <span class="close" onclick="closeModal()">&times;</span>
        <button class="nav-button prev-button" onclick="previousItem()" id="prevButton">‹</button>
        <button class="nav-button next-button" onclick="nextItem()" id="nextButton">›</button>
        <img class="modal-content" id="modalImage">
        <video class="modal-content" id="modalVideo" controls>
            Tu navegador no soporta el elemento video.
        </video>
    </div>

    <script>
        // Variables para la navegación de la galería
        let currentItemIndex = 0;
        let galleryItems = [];

        // Categorías y distancias
        const categories = [
            { name: 'Infantil B', gender: ['femenino', 'masculino'], min: 12, max: 13, distances: ['1000'] },
            { name: 'Juvenil A', gender: ['femenino', 'masculino'], min: 14, max: 15, distances: ['1000'] },
            { name: 'Juvenil B', gender: ['femenino', 'masculino'], min: 16, max: 18, distances: ['1000'] },
            { name: 'Pre-Máster', gender: ['femenino', 'masculino'], min: 19, max: 24, distances: ['1000', '2000'] },
            { name: 'Máster A', gender: ['femenino', 'masculino'], min: 25, max: 29, distances: ['1000', '2000'] },
            { name: 'Máster B', gender: ['femenino', 'masculino'], min: 30, max: 34, distances: ['1000', '2000'] },
            { name: 'Máster C', gender: ['femenino', 'masculino'], min: 35, max: 39, distances: ['1000', '2000'] },
            { name: 'Máster D', gender: ['femenino', 'masculino'], min: 40, max: 44, distances: ['1000', '2000'] },
            { name: 'Máster E', gender: ['femenino', 'masculino'], min: 45, max: 49, distances: ['1000', '2000'] },
            { name: 'Máster F', gender: ['femenino', 'masculino'], min: 50, max: 54, distances: ['1000', '2000'] },
            { name: 'Máster G', gender: ['femenino', 'masculino'], min: 55, max: 59, distances: ['1000', '2000'] },
            { name: 'Máster H', gender: ['femenino', 'masculino'], min: 60, max: 64, distances: ['1000', '2000'] },
            { name: 'Máster I', gender: ['femenino', 'masculino'], min: 65, max: 69, distances: ['1000', '2000'] },
            { name: 'Máster J', gender: ['femenino', 'masculino'], min: 70, max: 120, distances: ['1000', '2000'] },
        ];

        function getCategory(gender, age) {
            return categories.find(cat => cat.gender.includes(gender) && age >= cat.min && age <= cat.max);
        }

        document.getElementById('gender').addEventListener('change', updateCategoryAndDistances);
        document.getElementById('age').addEventListener('input', updateCategoryAndDistances);
        document.getElementById('testType').addEventListener('change', updateCategoryAndDistances);

        function updateCategoryAndDistances() {
            const gender = document.getElementById('gender').value;
            const age = parseInt(document.getElementById('age').value, 10);
            const testType = document.getElementById('testType').value;
            const categoryInput = document.getElementById('category');
            const distanceSelect = document.getElementById('distance');
            distanceSelect.innerHTML = '<option value="">Selecciona una distancia</option>';
            if (!gender || isNaN(age)) {
                categoryInput.value = '';
                return;
            }
            const category = getCategory(gender, age);
            if (category) {
                categoryInput.value = category.name;
                // Filter distances based on test type
                let availableDistances = category.distances;
                if (testType === 'relevo') {
                    availableDistances = availableDistances.filter(dist => dist === '1000');
                }
                availableDistances.forEach(dist => {
                    const label = dist + ' metros';
                    const opt = document.createElement('option');
                    opt.value = dist;
                    opt.textContent = label;
                    distanceSelect.appendChild(opt);
                });
            } else {
                categoryInput.value = 'No elegible';
            }
        }

        // Precios según etapa y tipo de prueba
        const prices = {
            preventa: {
                individual: 25000,
                relevo: 60000
            },
            general: {
                individual: 35000,
                relevo: 90000
            }
        };

        function updateBuyButtonPrice() {
            const stage = document.getElementById('stage').value;
            const testType = document.getElementById('testType').value;
            const buyButton = document.getElementById('buyButton');
            if (stage && testType) {
                const price = prices[stage][testType];
                let label = '🎯 Comprar Entrada';
                if (price) {
                    label += ` - $${price.toLocaleString('es-CL')}.`;
                }
                buyButton.textContent = label;
            } else {
                buyButton.textContent = '🎯 Comprar Entrada';
            }
        }

        document.getElementById('stage').addEventListener('change', updateBuyButtonPrice);
        document.getElementById('testType').addEventListener('change', updateBuyButtonPrice);
        document.addEventListener('DOMContentLoaded', updateBuyButtonPrice);

        document.getElementById('ticketForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const buyButton = document.getElementById('buyButton');
            const originalButtonText = buyButton.textContent;

            // Show loading state
            buyButton.textContent = '⏳ Procesando...';
            buyButton.disabled = true;
            buyButton.style.opacity = '0.7';
            buyButton.style.cursor = 'not-allowed';

            const formData = {
                name: document.getElementById('name').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                gender: document.getElementById('gender').value,
                age: document.getElementById('age').value,
                club: document.getElementById('club').value,
                category: document.getElementById('category').value,
                distance: document.getElementById('distance').value,
                stage: document.getElementById('stage').value,
                test_type: document.getElementById('testType').value
            };

            if (formData.category === 'No elegible') {
                alert('No hay categoría disponible para tu edad/género.');
                // Reset button state
                buyButton.textContent = originalButtonText;
                buyButton.disabled = false;
                buyButton.style.opacity = '1';
                buyButton.style.cursor = 'pointer';
                return;
            }

            let response;
            let result;

            try {
                response = await fetch('https://entradas-back-66181581846.europe-west1.run.app/api/purchase', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                if (response.ok) {
                    result = await response.json();

                    // Check if we have an init_point to redirect to
                    if (result.init_point) {
                        // Redirect to MercadoPago checkout
                        window.location.href = result.init_point;
                    } else {
                        // Fallback success message
                        alert('¡Compra exitosa! Revisa tu correo para ver la confirmación.');
                        this.reset();
                        document.getElementById('category').value = '';
                        document.getElementById('distance').innerHTML = '<option value="">Selecciona una distancia</option>';
                    }
                } else {
                    const errorData = await response.json().catch(() => ({}));
                    const errorMessage = errorData.message || 'Hubo un error en la compra. Por favor intenta nuevamente.';
                    alert(errorMessage);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error en la conexión. Por favor intenta más tarde.');
            } finally {
                // Reset button state if not redirecting
                if (!response?.ok || !result?.init_point) {
                    buyButton.textContent = originalButtonText;
                    buyButton.disabled = false;
                    buyButton.style.opacity = '1';
                    buyButton.style.cursor = 'pointer';
                }
            }
        });

        // Funciones para la galería
        function openModal(src, type) {
            const modal = document.getElementById('imageModal');
            const modalImage = document.getElementById('modalImage');
            const modalVideo = document.getElementById('modalVideo');

            // Encontrar el índice del elemento actual
            currentItemIndex = galleryItems.findIndex(item => item.src === src);
            if (currentItemIndex === -1) currentItemIndex = 0;

            if (type === 'image') {
                modalImage.src = src;
                modalImage.style.display = 'block';
                modalVideo.style.display = 'none';
            } else if (type === 'video') {
                modalVideo.src = src;
                modalVideo.style.display = 'block';
                modalImage.style.display = 'none';
            }

            modal.style.display = 'block';
            updateNavigationButtons();
        }

        function closeModal() {
            const modal = document.getElementById('imageModal');
            const modalImage = document.getElementById('modalImage');
            const modalVideo = document.getElementById('modalVideo');

            modal.style.display = 'none';
            modalImage.style.display = 'none';
            modalVideo.style.display = 'none';

            // Pausar el video cuando se cierra el modal
            modalVideo.pause();
        }

        function previousItem() {
            if (currentItemIndex > 0) {
                currentItemIndex--;
                showCurrentItem();
            }
        }

        function nextItem() {
            if (currentItemIndex < galleryItems.length - 1) {
                currentItemIndex++;
                showCurrentItem();
            }
        }

        function showCurrentItem() {
            const item = galleryItems[currentItemIndex];
            const modalImage = document.getElementById('modalImage');
            const modalVideo = document.getElementById('modalVideo');

            if (item.type === 'image') {
                modalImage.src = item.src;
                modalImage.style.display = 'block';
                modalVideo.style.display = 'none';
            } else if (item.type === 'video') {
                modalVideo.src = item.src;
                modalVideo.style.display = 'block';
                modalImage.style.display = 'none';
            }

            updateNavigationButtons();
        }

        function updateNavigationButtons() {
            const prevButton = document.getElementById('prevButton');
            const nextButton = document.getElementById('nextButton');

            prevButton.disabled = currentItemIndex === 0;
            nextButton.disabled = currentItemIndex === galleryItems.length - 1;
        }

        // Inicializar la lista de elementos de la galería
        function initializeGallery() {
            galleryItems = [
                { src: 'gallery/WhatsApp Image 2025-05-22 at 08.36.08_2ccf344b.jpg', type: 'image' },
                { src: 'gallery/WhatsApp Image 2025-05-22 at 08.36.08_beee2ebf.jpg', type: 'image' },
                { src: 'gallery/WhatsApp Image 2025-05-22 at 08.36.08_d5d63017.jpg', type: 'image' },
                { src: 'gallery/WhatsApp Image 2025-05-22 at 08.36.09_20ca8526.jpg', type: 'image' },
                { src: 'gallery/WhatsApp Image 2025-05-22 at 08.36.11_41270771.jpg', type: 'image' },
                { src: 'gallery/WhatsApp Image 2025-05-22 at 08.36.14_8faaf407.jpg', type: 'image' },
                { src: 'gallery/WhatsApp Video 2025-05-22 at 08.36.11_b1a08203.mp4', type: 'video' },
                { src: 'gallery/WhatsApp Video 2025-05-22 at 08.36.14_c4fba06f.mp4', type: 'video' }
            ];
        }

        // Inicializar la galería cuando se carga la página
        document.addEventListener('DOMContentLoaded', initializeGallery);

        // Cerrar modal al hacer clic fuera del contenido
        window.onclick = function(event) {
            const modal = document.getElementById('imageModal');
            if (event.target === modal) {
                closeModal();
            }
        }

        // Cerrar modal con la tecla Escape
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeModal();
            }
        });
    </script>
</body>
</html>
